{{- /*
This template will create a Kubernetes Secret named by .Values.secret.name (default "supabase-secrets")
It uses Helm/Sprig randAlphaNum to generate random values, and b64enc to put them into Secret.data.
The `lookup` check prevents re-creating the secret if it already exists in the cluster (so upgrades won't
unnecessarily rotate values).
*/ -}}
{{- $name := .Values.supabase.secret.name | default "supabase-secrets" -}}
{{- if not (lookup "v1" "Secret" .Release.Namespace $name) }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ $name }}
  labels:
    app.kubernetes.io/managed-by: {{ .Release.Service }}
type: Opaque
data:
  # JWT
  jwt-anonKey: {{ randAlphaNum 64 | b64enc | quote }}
  jwt-serviceKey: {{ randAlphaNum 64 | b64enc | quote }}
  jwt-secret: {{ randAlphaNum 64 | b64enc | quote }}

  # DB
  db-password: {{ randAlphaNum 24 | b64enc | quote }}
  db-database: {{ printf "postgres-%s" (randAlphaNum 8) | b64enc | quote }}

  # SMTP
  smtp-username: {{ randAlphaNum 12 | b64enc | quote }}
  smtp-password: {{ randAlphaNum 24 | b64enc | quote }}

  # Analytics
  analytics-publicAccessToken: {{ randAlphaNum 32 | b64enc | quote }}
  analytics-privateAccessToken: {{ randAlphaNum 64 | b64enc | quote }}

  # Dashboard
  dashboard-username: {{ randAlphaNum 12 | b64enc | quote }}
  dashboard-password: {{ randAlphaNum 24 | b64enc | quote }}
  dashboard-openAiApiKey: {{ randAlphaNum 40 | b64enc | quote }}

  # Realtime
  realtime-secretKeyBase: {{ randAlphaNum 64 | b64enc | quote }}

  # Meta
  meta-cryptoKey: {{ randAlphaNum 64 | b64enc | quote }}
{{- end }}
